var __accessCheck=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},__privateGet=(e,t,i)=>(__accessCheck(e,t,"read from private field"),i?i.call(e):t.get(e)),__privateAdd=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},__privateMethod=(e,t,i)=>(__accessCheck(e,t,"access private method"),i);!function(e){!function(e){var t,i,r,n,s,o,a;if("use strict",false){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}let c=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&i[e];if(36>r)t+=r.toString(36);else if(62>r)t+=(r-26).toString(36).toUpperCase();else if(63>r)t+="_";else t+="-"}return t};function u(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));if(t)return t[2]}function d(e,t,i=""){const r=new Date;r.setTime(r.getTime()+365*24*60*60*1e3),document.cookie=`${e}=${t}; expires=${r.toUTCString()}; path=/; ${i?`domain=${i}`:""}`}function l(e){const t=new RegExp(`[?&]${e}=([^&#]*)`).exec(window.location.href);return t?decodeURI(t[1]):null}var g=(e=>(e["SetDomain"]="setDomain",e["SetListToken"]="setListToken",e["SetUserId"]="setUserId",e["SetEvent"]="setEvent",e["SetCookie"]="setCookie",e["SetAutoFunnelData"]="setAutoFunnelData",e["Push"]="push",e["SetCustomServiceWorkerPath"]="setCustomSwPath",e["ViewItem"]="viewItem",e["ViewCategory"]="viewCategory",e["LikeItem"]="likeItem",e["UnlikeItem"]="unlikeItem",e["WishListItem"]="wishlistItem",e["ShopifyAbandonedCart"]="shopifyAbandonedCart",e["SaveEvent"]="saveEvent",e["FlushEvents"]="flushEvents",e["SetUserDevice"]="setUserDevice",e["SetUserLocation"]="setUserLocation",e["SetVisitUrlPath"]="setVisitUrlPath",e["SetLastActivityDate"]="setLastActivityDate",e["SetIsNewVisitor"]="setIsNewVisitor",e["SetHasUserVisitPage"]="setHasUserVisitPage",e["SetRawEvent"]="setRawEvent",e["ImportScript"]="importScript",e["DelayScript"]="delayScript",e["InitScript"]="initScript",e))(g||{});const v="_grDebugMode",p=new class{isDebugEnabled(){return!!window.sessionStorage.getItem(v)}startDebug(){window.sessionStorage.setItem(v,"true")}},h=new class{get isLoggingEnabled(){return p.isDebugEnabled()}log(...e){this.displayLog("log",...e)}info(...e){this.displayLog("info",...e)}error(...e){this.displayLog("error",...e)}warn(...e){this.displayLog("warn",...e)}displayLog(e,...t){if(this.isLoggingEnabled)console[e](...t)}},w=10;class f{constructor(){this._cvar=[]}setTrackerUrl(e){this.trackerUrl=e}markAsEnabled(e){this.isEnabled=e}setUserId(e){this.uid=e}setCustomVariable(e,t,i){if(!this._cvar[e])this._cvar[e]=[];this._cvar[e].push(t),this._cvar[e].push(i)}setGenerationTime(){var e;if(this.gt_ms)return;const t=null==(e=performance.getEntriesByType("navigation")[0])?void 0:e.toJSON();if(t)this.gt_ms=Math.floor(t.responseEnd-t.requestStart)}trackEvent(e,t,i,r){this.trackPageView(Object.assign({e_c:e,e_a:t,e_n:i,...r&&{e_v:r}}))}getCustomVariable(){return JSON.stringify(Object.assign({},this._cvar))}static getScreenResolution(){return`${screen.width??w}x${screen.height??w}`}static encodeUrlParam(e){return`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`}getFullTrackerUrl(e){const t=new Date;return Object.entries({...e,...document.referrer&&{urlRef:document.referrer},url:window.location.href,uid:this.uid,_cvar:this.getCustomVariable(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),res:f.getScreenResolution(),gt_ms:this.gt_ms}).reduce(((e,t)=>void 0===t[1]?e:`${e}&${f.encodeUrlParam(t)}`),this.trackerUrl)}trackPageView(e){if(e||this.isEnabled)if(this.setGenerationTime(),window.fetch)fetch(this.getFullTrackerUrl(e),{method:"GET",mode:"no-cors"}).catch((e=>{h.error("Error while sending tracking data:",e)}));else new Image(1,1).src=this.getFullTrackerUrl(e)}}var m=(e=>(e["UuidHasBeenSet"]="grUuidHasBeenSet",e["PopupsRendererCustomUrl"]="grPopupsRendererCustomUrl",e))(m||{});class y{constructor(){__privateAdd(this,t,new Proxy({},{get(e,t){if(t in e)return e[t];else return e[t]=[],e[t]}}))}addEvent(e,i){__privateGet(this,t)[e].push(i)}drainEvents(e){const i=__privateGet(this,t)[e];return __privateGet(this,t)[e]=[],i}hasDelayedEvents(e){return __privateGet(this,t)[e].length>0}}t=new WeakMap,i=new WeakMap,r=new WeakMap;const S=new class{constructor(){__privateAdd(this,i,{}),__privateAdd(this,r,new y)}publish(e,...t){var n;let s=false;if(null==(n=__privateGet(this,i)[e])?void 0:n.length)__privateGet(this,i)[e].forEach((i=>{if(s)h.error(`More than one subscriber is listening on event ${e}`);else i(...t),s=true,h.log(`Event ${e} published with arguments'`,...t)}));else __privateGet(this,r).addEvent(e,t)}subscribe(e,t){if(!__privateGet(this,i)[e])__privateGet(this,i)[e]=[];if(__privateGet(this,r).hasDelayedEvents(e))__privateGet(this,r).drainEvents(e).forEach((e=>t(...e)));__privateGet(this,i)[e].push(t)}unsubscribe(e,t){var r;const n=null==(r=__privateGet(this,i)[e])?void 0:r.indexOf(t);if(n>-1)__privateGet(this,i)[e].splice(n,1)}removeListeners(e){delete __privateGet(this,i)[e]}};var b=(e=>(e["DeviceType"]="debug_device_type",e["Location"]="debug_location",e["VisitUrlPath"]="debug_visit_url_path",e["BrowserStorageLastActivityDate"]="debug_browser_storage_last_activity_date",e["NewVisitor"]="debug_new_visitor",e["HasUserVisitPage"]="debug_has_user_visit_page",e["Events"]="debug_events",e))(b||{});function D(){const e=e=>{const t=sessionStorage.getItem(e);if(t){if([b.DeviceType,b.VisitUrlPath,b.Location].includes(e))return t;if(e===b.BrowserStorageLastActivityDate){const e=new Date(t);return isNaN(e.getTime())?void 0:e}if([b.NewVisitor,b.HasUserVisitPage,b.Events].includes(e))try{return JSON.parse(t)}catch(i){h.error(`Invalid debug data for: ${e}`)}}};return{enabled:true,data:{[b.DeviceType]:e(b.DeviceType),[b.BrowserStorageLastActivityDate]:e(b.BrowserStorageLastActivityDate),[b.Location]:e(b.Location),[b.NewVisitor]:e(b.NewVisitor),[b.VisitUrlPath]:e(b.VisitUrlPath),[b.HasUserVisitPage]:e(b.HasUserVisitPage),[b.Events]:e(b.Events)}}}function I(e,t,i){const r=C.debugObject;C.debugObject={...r,data:{...null==r?void 0:r.data,[e]:t}},sessionStorage.setItem(e,i||String(t))}function E(e){var t,i;return null==(i=null==(t=C.debugObject)?void 0:t.data)?void 0:i[e]}function _(e,t){return C.isDebug?t:e}const C=new class{initialize(e){const{xsid:t,grid:i,clientLatestGrid:r,domain:n,aid:s,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,scriptsDomain:u,scriptsVersion:d,tracking:l,isDebugMode:g}=e;if(g)p.startDebug();window.__grIntegrationConfig=window.__grIntegrationConfig||{cData:{aid:s,grid:i,domain:n,useNOStorage:o,useBetterSubscriberIdentification:a,isServedFromCustomDomain:c,clientLatestGrid:r},visitor:{email:null,eComId:null,xsid:t},tracking:{isEnabled:l},webEvents:{isModuleInitialized:false,visitorApplicationEndpoint:null},webPush:{customSwPath:null,wpid:null,pushDomain:null,promptEndpoint:null},analyticsData:{scriptsDomain:u,scriptsVersion:d},eventBus:S,debug:g?D():void 0,delayedScripts:{}}}isWebEventModuleInitialized(){return window.__grIntegrationConfig.webEvents.isModuleInitialized??false}setWebEventModuleInitialized(){if(false===window.__grIntegrationConfig.webEvents.isModuleInitialized)window.__grIntegrationConfig.webEvents.isModuleInitialized=true}canUseBackendForSubscriberIdentification(){return window.__grIntegrationConfig.cData.useBetterSubscriberIdentification}getUserAid(){return window.__grIntegrationConfig.cData.aid}getClientLatestGrid(){return window.__grIntegrationConfig.cData.clientLatestGrid}getUserAnalyticsDomain(){return window.__grIntegrationConfig.cData.domain}enablePopupDevMode(){window.__grIntegrationConfig.setCustomPopupRendererUrl=e=>{window.sessionStorage.setItem(m.PopupsRendererCustomUrl,e)}}getPopupRendererCustomUrl(){return window.sessionStorage.getItem(m.PopupsRendererCustomUrl)}setCustomSwPath(e){if("string"!=typeof e)throw new Error("Path type must be string");if(!e.match(/gr_sw_main.js$/))throw new Error("Invalid sw file name");window.__grIntegrationConfig.webPush.customSwPath=e}getCustomSwPath(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.webPush.customSwPath}isTrackingEnabled(){return window.__grIntegrationConfig.tracking.isEnabled}isTrackingScriptServedFromCustomDomain(){return window.__grIntegrationConfig.cData.isServedFromCustomDomain}set visitorEmail(e){window.__grIntegrationConfig.visitor.email=e}get visitorEmail(){return window.__grIntegrationConfig.visitor.email}get pushWpid(){return window.__grIntegrationConfig.webPush.wpid}set pushWpid(e){window.__grIntegrationConfig.webPush.wpid=e}set pushDomain(e){window.__grIntegrationConfig.webPush.pushDomain=e}get pushDomain(){return window.__grIntegrationConfig.webPush.pushDomain}set pushPromptEndpoint(e){window.__grIntegrationConfig.webPush.promptEndpoint=e}get pushPromptEndpoint(){return window.__grIntegrationConfig.webPush.promptEndpoint}get eventBus(){return window.__grIntegrationConfig.eventBus}get canUseBackendStorageForEvents(){return window.__grIntegrationConfig.cData.useNOStorage}get webConnectScriptCdnUrl(){return window.__grIntegrationConfig.analyticsData.scriptsDomain}get webConnectCurrentScriptsVersion(){return window.__grIntegrationConfig.analyticsData.scriptsVersion}get isDebug(){var e,t;return!!(null==(t=null==(e=window.__grIntegrationConfig)?void 0:e.debug)?void 0:t.enabled)}set debugObject(e){window.__grIntegrationConfig.debug=e}get debugObject(){var e;return null==(e=window.__grIntegrationConfig)?void 0:e.debug}get delayedScripts(){var e;return(null==(e=window.__grIntegrationConfig)?void 0:e.delayedScripts)||{}}set delayedScripts(e){window.__grIntegrationConfig.delayedScripts=e}set visitorApplicationEndpoint(e){window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint=e}get visitorApplicationEndpoint(){return window.__grIntegrationConfig.webEvents.visitorApplicationEndpoint}};var T,V;(V=T||(T={}))["PageVisit"]="visit",V["Popup"]="popup",V["ViewItem"]="view_item",V["ViewCategory"]="view_category",V["WishlistItem"]="wishlist_item",V["LikeItem"]="like_item",V["UnlikeItem"]="unlike_item",void(V["ShopifyAbandonedCart"]="shopify_webhook_abandoned_cart");class P extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class U extends P{constructor(e){super(e)}}const k={cartToken:"string",urlToken:"string",visitorEmail:"string"},A=["cartToken","urlToken"];var L,x,N,O,B,$,R,F,M;(M=L||(L={}))["Inline"]="inline",void(M["Popup"]="popup"),(F=x||(x={}))["Hq"]="Hq",void(F["Us"]="Us"),void((N||(N={}))["UserAid"]="X-Aid"),(R=O||(O={}))["Active"]="active",void(R["Inactive"]="inactive"),($=B||(B={}))["FilterWebUrl"]="filter_web_url",$["TransferToBackend"]="transfer_to_backend",$["FilterWebSubscribers"]="filter_web_subscribers",$["AwaitScroll"]="await_scroll",void($["ShowPopup"]="react_popup");const j=204;function W(e,t){const i=e.isTextResponse??(null==t?void 0:t.isTextResponse);return fetch(e,{...t,headers:{...null==t?void 0:t.headers,...(null==t?void 0:t.omitAidHeader)?{}:{[N.UserAid]:C.getUserAid()}}}).then((async e=>{if(e.ok){if(e.status===j)return;return i?e.text():e.json()}const t=await e.text();return Promise.reject({statusCode:e.status,message:t})}))}const J=new class{retrieveXsid(){return W(new URL("retrieveXsid",C.getUserAnalyticsDomain()).href,{isTextResponse:true,credentials:"include"})}};var G=(e=>(e["v2"]="v2",e["af"]="af",e["wp"]="wp",e["we"]="we",e["ec"]="ec",e))(G||{}),q=(e=>(e["v2"]="GRV2",e["af"]="GRAF",e["wp"]="GRWP",e["we"]="GRWE",e["ec"]="GREC",e))(q||{});const H=new Map,z=(e,t)=>{if(!Array.isArray(e))switch(typeof e){case"string":e=[e];break;case"undefined":e=[];break;default:throw new TypeError(`Expected '${t}' to be a string or an array, but got a type of '${typeof e}'`)}return e.filter((e=>{if("string"!=typeof e){if(void 0===e)return false;throw new TypeError(`Expected '${t}' to be an array of strings, but found a type of '${typeof e}' in the array`)}return true}))};function K(e,t,i){return((e,t,i,r)=>{if(e=z(e,"inputs"),0===(t=z(t,"patterns")).length)return[];t=t.map((e=>((e,t)=>{t={caseSensitive:false,...t};const i=e+JSON.stringify(t);if(H.has(i))return H.get(i);const r="!"===e[0];if(r)e=e.slice(1);e=(e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e).replace(/\\\*/g,"[\\s\\S]*");const n=new RegExp(`^${e}$`,t.caseSensitive?"":"i");return n.negated=r,H.set(i,n),n})(e,i)));const{allPatterns:n}=i||{},s=[];for(const o of e){let e;const i=[...t].fill(false);for(const[r,n]of t.entries())if(n.test(o))if(i[r]=true,e=!n.negated,!e)break;if(!(false===e||void 0===e&&t.some((e=>!e.negated))||n&&i.some(((e,i)=>!e&&!t[i].negated))))if(s.push(o),r)break}return s})(e,t,i,true).length>0}var X,Y,Q,Z,ee,te,ie,re,ne,se,oe,ae,ce,ue,de,le,ge,ve,pe,he,we,fe,me,ye,Se,be,De,Ie,Ee,_e,Ce,Te,Ve,Pe;(Pe=X||(X={}))["ShowWhenCondition"]="showWhenCondition",Pe["VisitorsCondition"]="visitors",Pe["DeviceCondition"]="device",Pe["LocationCondition"]="location",Pe["ECommerceCondition"]="ecommerce",Pe["TriggerFrequency"]="frequency",Pe["PreventDisplay"]="preventDisplay",void(Pe["DateRange"]="dateRange"),(Ve=Y||(Y={}))["Mobile"]="mobile",Ve["Tablet"]="tablet",void(Ve["Desktop"]="desktop"),(Te=Q||(Q={}))["All"]="all",Te["New"]="new",void(Te["Returning"]="returning"),void((Z||(Z={}))["All"]="all"),(Ce=ee||(ee={}))["ConditionsLogicSeparator"]="conditionsLogicSeparator",void(Ce["ECommerceConditions"]="ecommerceConditions"),(_e=te||(te={}))["Amount"]="amount",void(_e["Date"]="date"),(Ee=ie||(ie={}))["And"]="and",void(Ee["Or"]="or"),(Ie=re||(re={}))["Exactly"]="exactly",Ie["LessThan"]="lessThan",void(Ie["MoreThan"]="moreThan"),(De=ne||(ne={}))["LastDays"]="lastDays",void(De["DateRange"]="dateRange"),(be=se||(se={}))["AnyProduct"]="any",be["AnyCategory"]="any",void(be["AnyProductLiked"]="any"),(Se=oe||(oe={}))["Category"]="category",void(Se["Product"]="product"),void((ae||(ae={}))["Product"]="product"),(ye=ce||(ce={}))["ViewProductOrCategory"]="productOrCategoryView",void(ye["LikeProduct"]="likeItem"),(me=ue||(ue={}))["Percent"]="percent",void(me["Selector"]="selector"),(fe=de||(de={}))["Instantly"]="instantly",fe["Delay"]="delay",fe["Exit"]="exit",fe["Scroll"]="scroll",void(fe["Inactivity"]="inactivity"),(we=le||(le={}))["AfterSubmit"]="submit",we["AfterClose"]="close",void(we["AfterTimes"]="timesAmount"),(he=ge||(ge={}))["Always"]="always",he["Session"]="session",void(he["EveryDays"]="everyDays"),(pe=ve||(ve={}))[pe["InvalidCssSelector"]=1]="InvalidCssSelector",pe[pe["EmptyCssSelector"]=2]="EmptyCssSelector",pe[pe["CssSelectorTooLong"]=3]="CssSelectorTooLong",pe[pe["CssInvalidType"]=4]="CssInvalidType",pe[pe["InvalidTimeoutProperty"]=5]="InvalidTimeoutProperty",pe[pe["ShowWhenScrollPercentInvalidValueType"]=6]="ShowWhenScrollPercentInvalidValueType",pe[pe["ShowWhenScrollPercentValueOutOfBound"]=7]="ShowWhenScrollPercentValueOutOfBound",pe[pe["VisitorTriggerEmpty"]=8]="VisitorTriggerEmpty",pe[pe["VisitorTriggerInvalidProperty"]=9]="VisitorTriggerInvalidProperty",pe[pe["DevicesTriggerEmpty"]=10]="DevicesTriggerEmpty",pe[pe["DevicesTriggerInvalidValue"]=11]="DevicesTriggerInvalidValue",pe[pe["FrequencyEmptyTrigger"]=12]="FrequencyEmptyTrigger",pe[pe["FrequencyTriggerInvalidName"]=13]="FrequencyTriggerInvalidName",pe[pe["FrequencyTriggerNDaysInvalidPropertyValue"]=14]="FrequencyTriggerNDaysInvalidPropertyValue",pe[pe["FrequencyTriggerNDaysEmptyValue"]=15]="FrequencyTriggerNDaysEmptyValue",pe[pe["PreventDisplayTriggerInvalidName"]=16]="PreventDisplayTriggerInvalidName",pe[pe["PreventDisplayTriggerAfterTimesNoValue"]=17]="PreventDisplayTriggerAfterTimesNoValue",pe[pe["PreventDisplayTriggerAfterTimesInvalidValue"]=18]="PreventDisplayTriggerAfterTimesInvalidValue",pe[pe["DateRangeInvalidFromDate"]=19]="DateRangeInvalidFromDate",pe[pe["DateRangeInvalidToDate"]=20]="DateRangeInvalidToDate",pe[pe["DateRangeDateFromAfterDateTo"]=21]="DateRangeDateFromAfterDateTo",pe[pe["DateRangeToBeforeCurrentTime"]=22]="DateRangeToBeforeCurrentTime",pe[pe["LocationEmptyTrigger"]=23]="LocationEmptyTrigger",pe[pe["LocationInvalidType"]=24]="LocationInvalidType",pe[pe["LackOfLogicSeparator"]=25]="LackOfLogicSeparator",pe[pe["LackOfTriggerConditions"]=26]="LackOfTriggerConditions",pe[pe["InvalidTriggerConditions"]=27]="InvalidTriggerConditions",pe[pe["NoProductOrCategorySelected"]=28]="NoProductOrCategorySelected",pe[pe["ProductInvalidType"]=29]="ProductInvalidType",pe[pe["CategoryInvalidType"]=30]="CategoryInvalidType",pe[pe["AmountInvalidConditionName"]=31]="AmountInvalidConditionName",pe[pe["AmountInvalidConditionValueType"]=32]="AmountInvalidConditionValueType",pe[pe["DateInvalidConditionName"]=33]="DateInvalidConditionName",pe[pe["DateLastDaysInvalidConditionValue"]=34]="DateLastDaysInvalidConditionValue",pe[pe["DateDateRangeInvalidConditionValue"]=35]="DateDateRangeInvalidConditionValue",pe[pe["DateDateRangeFromInvalidValue"]=36]="DateDateRangeFromInvalidValue",pe[pe["DateDateRangeToInvalidValue"]=37]="DateDateRangeToInvalidValue",pe[pe["DateDateRangeDateFromAfterDateTo"]=38]="DateDateRangeDateFromAfterDateTo",pe[pe["PopupTriggerInvalidName"]=39]="PopupTriggerInvalidName",pe[pe["PopupTriggerLackOfValuesInLikeItemTrigger"]=40]="PopupTriggerLackOfValuesInLikeItemTrigger",void(pe[pe["PopupTriggerLikeItemInvalidValues"]=41]="PopupTriggerLikeItemInvalidValues");class Ue extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name}}class ke extends Ue{constructor(){super("Failed to parse data from JSON string")}}var Ae=(e=>(e["visitorUuid"]="gaVisitorUuid",e["visitorValuable"]="gaIsValuable",e["VisitorResubscribed"]="gaVisitorResubscribed",e))(Ae||{}),Le=(e=>(e["Show"]="show",e["Close"]="close",e["Submit"]="submit",e))(Le||{});const xe=new class{constructor(){this.timer=Date.now()}getCurrentVisitOnPageTime(){return Date.now()-this.timer}};class Ne{constructor(e){this.eventType=e,this.aid=window.__grIntegrationConfig.cData.aid,this.grid=window.__grIntegrationConfig.cData.grid,this.time=xe.getCurrentVisitOnPageTime(),this.uuid=u(Ae.visitorUuid),this.url=window.location.href,this.occurredOn=new Date}get externalUid(){const{xsid:e,email:t,eComId:i}=window.__grIntegrationConfig.visitor;return i||e||t}toJSON(){return{aid:this.aid,grid:this.aid,uuid:this.uuid,externalUid:this.externalUid,time:this.time,url:this.url,eventType:this.eventType,occurredOn:this.occurredOn.toUTCString()}}toString(){return JSON.stringify(this.toJSON())}}class Oe extends Ne{constructor(e,t){super(T.Popup),this.popupEvent=e,this.popupId=t}toJSON(){return{...super.toJSON(),popupId:this.popupId,popupEvent:this.popupEvent}}}class Be extends Ne{toJSON(){return{...super.toJSON(),data:this.data}}}class $e extends Be{constructor(e){super(T.ViewItem),this.data=e}}class Re extends Ne{constructor(e){super(T.ViewCategory),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}}class Fe extends Be{constructor(e){super(T.WishlistItem),this.data=e}}class Me extends Be{constructor(e){super(T.LikeItem),this.data=e}}class je extends Ne{constructor(e){super(T.ShopifyAbandonedCart),this.data=e}toJSON(){return{...super.toJSON(),data:this.data}}}class We extends Be{constructor(e){super(T.UnlikeItem),this.data=e}}const Je=class{static getPageVisitEvent(){return new Ne(T.PageVisit)}static getPopupSubmitEvent(e){return new Oe(Le.Submit,e)}static getPopupShowEvent(e){return new Oe(Le.Show,e)}static getPopupCloseEvent(e){return new Oe(Le.Close,e)}static getViewItemEvent(e){var t;return new $e(__privateMethod(t=Je,n,s).call(t,e))}static getWishlistItemEvent(e){var t;return new Fe(__privateMethod(t=Je,n,s).call(t,e))}static getLikeItemEvent(e){var t;return new Me(__privateMethod(t=Je,n,s).call(t,e))}static getUnlikeItemEvent(e){var t;return new We(__privateMethod(t=Je,n,s).call(t,e))}static getViewCategoryEvent(e){const{name:t,id:i,shop:r}=e;return new Re({id:i,...t&&{name:t},...r&&{shop:r}})}static getShopifyIntegrationAbandonedCartEvent(e){try{return(e=>{if("object"!=typeof e||null===e)throw new U("Invalid data parameter type");else{const t=Object.entries(k),i=Object.keys(e);if(!A.every((e=>i.includes(e))))throw new U("Lack of required parameters");if(!t.every((([t,i])=>!e[t]||typeof e[t]===i)))throw new U("Properties have invalid type")}return true})(e),new je((t=e,i=Object.keys(k),Object.entries(t).reduce(((e,[t,r])=>{if(i.includes(t))e[t]=r;return e}),{})))}catch(r){return h.error(r),null}var t,i}};let Ge=Je;n=new WeakSet,s=e=>{const{product:t,categories:i,shop:r}=e,n=["id"],s=["id","sku","name","vendor","price","currency"],o=["id","name"],a={product:{}};if(!(null==t?void 0:t.id))return h.error(`Missing required param (product_id: ${(null==t?void 0:t.id)??"undefined"}`),null;if(Object.keys(r??{}).forEach((e=>{if(n.includes(e)){if(!a.shop)a.shop={};a.shop[e]=r[e]}})),Object.keys(t).forEach((e=>{if(s.includes(e))a.product[e]=t[e]})),Array.isArray(i))a.categories=i.map((e=>{const t={};if(Object.keys(e).forEach((i=>{if(o.includes(i))t[i]=e[i]})),t.id)return t;else return null})).filter(Boolean);return a},__privateAdd(Ge,n);class qe{static sendJSON(e,t){navigator.sendBeacon(e,new Blob([JSON.stringify({...JSON.parse(t),[N.UserAid]:C.getUserAid()})],{type:"application/json"}))}}const He=new class{constructor(){this.popupsCachedData={}}getUserLastActivityDate(){const e=C.getUserAid();return W(new URL(`activity/session/${e}/${u(Ae.visitorUuid)}`,C.getUserAnalyticsDomain()).href)}async addPopupEventToStorage(e){qe.sendJSON(new URL("activity/event",C.getUserAnalyticsDomain()).href,JSON.stringify(e.toJSON()))}async getPopupActivityData(e){if(this.popupsCachedData)return this.popupsCachedData;const t=C.getUserAid();return this.popupsCachedData=await W(new URL(`activity/popups/${t}/${u(Ae.visitorUuid)}/${e}`,C.getUserAnalyticsDomain()).href),this.popupsCachedData}async saveEventsToStorage(e){qe.sendJSON(new URL("activity/event",C.getUserAnalyticsDomain()).href,JSON.stringify({aid:window.__grIntegrationConfig.cData.aid,grid:window.__grIntegrationConfig.cData.grid,events:e.map((e=>e.toJSON()))}))}},ze=Symbol("StorageService");class Ke{constructor(e){if(new.target===Ke&&e!==ze)throw new Error(`Invalid ${new.target.name} constructor`)}async isNewVisitor(){return!(await this.getLastActivityDate())}getLastActivityDate(){return C.canUseBackendStorageForEvents?this.getLastActivityDateFromBackendStorage():this.getLastActivityDateFromBrowserStorage()}async getLastActivityDateFromBackendStorage(){const e=await He.getUserLastActivityDate();if(null==e?void 0:e.lastActivity)return new Date(e.lastActivity)}getLastActivityDateFromBrowserStorage(){var e;const t=u(Ae.visitorUuid),i=localStorage.getItem("gaLocalStorageVisitKey");let r;try{r=JSON.parse(i)}catch{throw new ke}if(null==r?void 0:r[t])return Promise.resolve(new Date(null==(e=r[t])?void 0:e.lastActivity));else return null}saveUserActivity(){C.eventBus.publish(g.SaveEvent,T.PageVisit,null,{sendToBackend:true,saveToLocal:false}),this.saveUserActivityToBrowserStorage()}saveUserActivityToBrowserStorage(){const e={[u(Ae.visitorUuid)]:{lastActivity:Ge.getPageVisitEvent().occurredOn.toUTCString()}};try{window.localStorage.setItem("gaLocalStorageVisitKey",JSON.stringify(e))}catch{throw new ke}}}const Xe=new Ke(ze),Ye=Symbol("DebugStorageService");class Qe extends Ke{constructor(e){if(super(),new.target===Qe&&e!==Ye)throw new Error(`Invalid ${new.target.name} constructor`)}getLastActivityDate(){var e;const t=E(b.BrowserStorageLastActivityDate);if(isNaN(null==(e=null==t?void 0:t.getTime)?void 0:e.call(t)))return super.getLastActivityDate();else return Promise.resolve(t)}setLastActivityDate(e){const t=new Date(e);if(isNaN(t.getTime()))return h.error("Incorrect dateString for last activity date. Try again with isoString."),null;I(b.BrowserStorageLastActivityDate,t,t.toISOString())}isNewVisitor(){const e=E(b.NewVisitor);if(void 0===e)return super.isNewVisitor();else return Promise.resolve(e)}setIsNewVisitor(e){I(b.NewVisitor,e,String(e))}}const Ze=new Qe(Ye);function et(){return _(Xe,Ze)}var tt=(e=>(e["Always"]="always",e["OnceEveryDays"]="xDays",e["Session"]="everySession",e))(tt||{});const it=1e3*60*60*24,rt=Symbol("SessionService");class nt{constructor(e){if(new.target===nt&&e!==rt)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){return this.getSessionVisitData().count>1}saveUserVisit(){const e=this.getSessionVisitData()||{count:0};sessionStorage.setItem("gaUserPageSessionVisit",JSON.stringify({...e,count:e.count+1}))}getSessionVisitData(){return JSON.parse(sessionStorage.getItem("gaUserPageSessionVisit"))}}const st=new nt(rt),ot=Symbol("DebugSessionService");class at extends nt{constructor(e){if(super(),new.target===at&&e!==ot)throw new Error(`Invalid ${new.target.name} constructor`)}hasUserVisitedPage(){const e=E(b.HasUserVisitPage);if(void 0===e)return super.hasUserVisitedPage();else return e}setHasUserVisitedPage(e){I(b.HasUserVisitPage,e)}}const ct=new at(ot);function ut(){return _(st,ct)}const dt=Symbol("VisitService");class lt{constructor(e){if(new.target===lt&&e!==dt)throw new Error(`Invalid ${new.target.name} constructor`)}async validateFrequencyProperty(e,t=0){if(e===tt.Session)return!ut().hasUserVisitedPage();else if(e===tt.OnceEveryDays){const e=await et().getLastActivityDate();if(e)return((e,t)=>{const i=new Date(e+t*it),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);return Date.now()>=Date.parse(r.toString())})(e.getTime(),t)}return true}async validateVisitorsProperty(e){const t=await et().isNewVisitor();switch(e){case Q.New:return t;case Q.Returning:return!t;default:return true}}validateUrlPath(e="*"){const t=window.location.pathname;return this.validatePath(e,t)}validatePath(e,t){return K(t,e)}}const gt=new lt(dt),vt=Symbol("DebugVisitService");class pt extends lt{constructor(e){if(super(),new.target===pt&&e!==vt)throw new Error(`Invalid ${new.target.name} constructor`)}validateUrlPath(e="*"){const t=E(b.VisitUrlPath);if(void 0===t)return super.validateUrlPath(e);else return super.validatePath(e,t)}setVisitPathUrl(e){if("string"!=typeof e)return h.error("Invalid url path type. Try again with string variable"),null;I(b.VisitUrlPath,e)}}const ht=new pt(vt);var wt=(e=>(e[e["Mobile"]=480]="Mobile",e[e["Tablet"]=768]="Tablet",e))(wt||{});const ft=Symbol("DeviceService");class mt{constructor(e){if(new.target===mt&&e!==ft)throw new Error(`Invalid ${new.target.name} constructor`)}detectDeviceTypeByScreenWidth(e){var t;const{availWidth:i,availHeight:r}=screen;let n=null==(t=screen.orientation)?void 0:t.type;if(!n)n=window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait";const s=n.match(/landscape/)?r:i;if(wt.Mobile>=s)return Y.Mobile;else if(s>wt.Mobile&&wt.Tablet>=s)return Y.Tablet;return e?Y.Tablet:Y.Desktop}getDeviceType(){const{userAgentData:e}=window.navigator;if(e){const{mobile:t}=e;if(t)return this.detectDeviceTypeByScreenWidth(true);else return Y.Desktop}return this.detectDeviceTypeByScreenWidth()}}const yt=new mt(ft),St=Symbol("DebugDeviceService");class bt extends mt{constructor(e){if(super(),new.target===bt&&e!==St)throw new Error(`Invalid ${new.target.name} constructor`)}getDeviceType(){const e=E(b.DeviceType);if(!e)return super.getDeviceType();if(!Object.values(Y).includes(e))return h.error("Incorrect debug device type. Check if device is correct. Instead of that we will use normal values"),super.getDeviceType();else return e}setDeviceType(e){I(b.DeviceType,e)}}const Dt=new bt(St),It=Symbol("LocationService");class Et{constructor(e){if(new.target===Et&&e!==It)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const{domain:e}=window.__grIntegrationConfig.cData;return fetch(`${e}web-user-data/country`).then((e=>e.text()))}}const _t=new Et(It),Ct=Symbol("DebugLocationService");class Tt extends Et{constructor(e){if(super(),new.target===Tt&&e!==Ct)throw new Error(`Invalid ${new.target.name} constructor`)}getVisitorCountryCode(){const e=E(b.Location);if(!e)return super.getVisitorCountryCode();else return Promise.resolve(e)}setVisitorCountryCode(e){if("string"!=typeof e)return h.error("Incorrect debug country code value"),null;I(b.Location,e)}}const Vt=new Tt(Ct);var Pt=(e=>(e["Events"]="gr_webconnect",e["VisitorJourneys"]="gr_visitor_journeys",e))(Pt||{});const Ut={gr_webconnect:1,gr_visitor_journeys:1};var kt=(e=>(e["UserActivityEvents"]="user_activity_events",e))(kt||{}),At=(e=>(e["EventType"]="eventType",e["VisitorUuid"]="visitorUuid",e["EventTypeWithVisitor"]="eventType, visitorUuid",e))(At||{});let Lt,xt;const Nt=new WeakMap,Ot=new WeakMap,Bt=new WeakMap,$t=new WeakMap,Rt=new WeakMap;let Ft={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return Ot.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Bt.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return jt(e[t])},set:(e,t,i)=>(e[t]=i,true),has(e,t){if(e instanceof IDBTransaction&&("done"===t||"store"===t))return true;else return t in e}};function Mt(e){if("function"==typeof e)return function(e){if(e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype))return function(t,...i){const r=e.call(Wt(this),t,...i);return Bt.set(r,t.sort?t.sort():[t]),jt(r)};if((xt||(xt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e))return function(...t){return e.apply(Wt(this),t),jt(Nt.get(this))};else return function(...t){return jt(e.apply(Wt(this),t))}}(e);if(e instanceof IDBTransaction)!(e=>{if(Ot.has(e))return;const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",s),e.removeEventListener("abort",s)},n=()=>{t(),r()},s=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",s),e.addEventListener("abort",s)}));Ot.set(e,t)})(e);if(t=e,(Lt||(Lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e)))return new Proxy(e,Ft);else return e;var t}function jt(e){if(e instanceof IDBRequest)return(e=>{const t=new Promise(((t,i)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",s)},n=()=>{t(jt(e.result)),r()},s=()=>{i(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",s)}));return t.then((t=>{if(t instanceof IDBCursor)Nt.set(t,e)})).catch((()=>{})),Rt.set(t,e),t})(e);if($t.has(e))return $t.get(e);const t=Mt(e);if(t!==e)$t.set(e,t),Rt.set(t,e);return t}const Wt=e=>Rt.get(e),Jt=["get","getKey","getAll","getAllKeys","count"],Gt=["put","add","delete","clear"],qt=new Map;function Ht(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(qt.get(t))return qt.get(t);const i=t.replace(/FromIndex$/,""),r=t!==i,n=Gt.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Jt.includes(i)))return;const s=async function(e,...t){const s=this.transaction(e,n?"readwrite":"readonly");let o=s.store;if(r)o=o.index(t.shift());return(await Promise.all([o[i](...t),n&&s.done]))[0]};return qt.set(t,s),s}var zt;zt=Ft,void(Ft={...zt,get(e,t,i){return Ht(e,t)||zt.get(e,t,i)},has(e,t){return!!Ht(e,t)||zt.has(e,t)}});const Kt=new class{openEventsDatabaseConnection(e){return this.openConnection(Pt.Events,Ut[Pt.Events],e)}openAutomationJourneysDatabaseConnection(e){return this.openConnection(Pt.VisitorJourneys,Ut[Pt.VisitorJourneys],e)}async openConnection(e,t,i){const r=await((e,t,{blocked:i,upgrade:r,blocking:n,terminated:s}={})=>{const o=indexedDB.open(e,t),a=jt(o);if(r)o.addEventListener("upgradeneeded",(e=>{r(jt(o.result),e.oldVersion,e.newVersion,jt(o.transaction),e)}));if(i)o.addEventListener("blocked",(e=>i(e.oldVersion,e.newVersion,e)));return a.then((e=>{if(s)e.addEventListener("close",(()=>s()));if(n)e.addEventListener("versionchange",(e=>n(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a})(e,t,{blocked(e,t,i){h.error(`Connection to old db version: ${t} not closed. Version ${e} not available`,i)},upgrade(e,t,r){h.log(`New db version ${r} detected, upgrading from ${t}`),i(t,r,e)},terminated(){h.log("Closing db connection")},blocking(e,t,i){h.log(`Current connection od db version ${e} is blocking connection to version ${t}.`,i),r.close()}});return r}},Xt=Symbol("BrowserEventsStorageService"),Yt=class{constructor(e){if(__privateAdd(this,o),new.target===Yt&&e!==Xt)throw new Error(`Invalid ${new.target.name} constructor`)}async saveEvent(e){const t=e instanceof Ne?e.toJSON():e;try{const e=(await Kt.openEventsDatabaseConnection(__privateMethod(this,o,a))).transaction(kt.UserActivityEvents,"readwrite"),i=e.objectStore(kt.UserActivityEvents);await i.add(t),await e.done}catch(i){h.error("Error while saving event to database",i)}}async getEvents(e){const t=u(Ae.visitorUuid);try{const i=(await Kt.openEventsDatabaseConnection(__privateMethod(this,o,a))).transaction(kt.UserActivityEvents,"readwrite"),r=i.objectStore(kt.UserActivityEvents).index(At.EventTypeWithVisitor),n=await r.getAll([e,t]);return await i.done,n}catch(i){h.error("Error while reading from database",i)}}async getPopupECommerceEvents(e){const t=u(Ae.visitorUuid),i=(await Kt.openEventsDatabaseConnection(__privateMethod(this,o,a))).transaction(kt.UserActivityEvents,"readwrite").store.index(At.VisitorUuid),r=[];let n=await i.openCursor(IDBKeyRange.only(t));for(;n;){const{value:t}=n;if(e(t))r.push(t);n=await n.continue()}return r}};let Qt=Yt;o=new WeakSet,a=(e,t,i)=>{if(0===e&&1===t)!(e=>{if(!e.objectStoreNames.contains(kt.UserActivityEvents))try{const t=e.createObjectStore(kt.UserActivityEvents,{keyPath:"id",autoIncrement:true});t.createIndex(At.EventType,"eventType",{unique:false}),t.createIndex(At.VisitorUuid,"uuid",{unique:false}),t.createIndex(At.EventTypeWithVisitor,["eventType","uuid"])}catch(t){h.error("Error while initializing/upgrading database",t)}})(i)};const Zt=new Qt(Xt),ei=Symbol("DebugBrowserEventsStorageService");class ti extends Qt{constructor(e){if(super(),new.target===ti&&e!==ei)throw new Error(`Invalid ${new.target.name} constructor`)}async getPopupECommerceEvents(e){const t=E(b.Events)||[];if(!t.length)return super.getPopupECommerceEvents(e);else return t.filter(e)}async getEvents(e){const t=u(Ae.visitorUuid),i=E(b.Events)||[];if(!i.length)return super.getEvents(e);else return i.filter((({eventType:i,uuid:r})=>i===e&&r===t))}async saveEvent(e){const t=e instanceof Ne?e.toJSON():e,i=[...E(b.Events)||[],t];try{const e=JSON.stringify(i);I(b.Events,i,e)}catch(r){h.error(`Can't parse new debug events. Try again.`)}}}const ii=new ti(ei);function ri(){return _(Zt,ii)}const ni={[T.PageVisit]:Ge.getPageVisitEvent,[T.ViewItem]:Ge.getViewItemEvent,[T.WishlistItem]:Ge.getWishlistItemEvent,[T.LikeItem]:Ge.getLikeItemEvent,[T.UnlikeItem]:Ge.getUnlikeItemEvent,[T.ViewCategory]:Ge.getViewCategoryEvent},si=new class{constructor(){this.events=[]}push(e,t,i){if(void 0===i.saveToLocal||i.saveToLocal){const i=this.getEvent(e,t);if(i)ri().saveEvent(i);else return h.warn(`Invalid event params`,e,t),void 0}if(i.sendToBackend)this.events.push([e,t])}flush(){if(this.events.length&&C.canUseBackendStorageForEvents){const e=this.events.map((([e,t])=>this.getEvent(e,t))).filter(Boolean);if(e.length)He.saveEventsToStorage(e)}this.events=[]}getEvent(e,t){const i=ni[e];return"function"==typeof i?i(t):null}},oi=new class{isScriptDelayed(e){return Object.keys(C.delayedScripts).includes(e)}delay(e){if(!this.isScriptDelayed(e))C.delayedScripts={...C.delayedScripts,[e]:void 0}}storeDelayedScriptParams(e,t){if(this.isScriptDelayed(e))C.delayedScripts={...C.delayedScripts,[e]:t}}initScript(e){var t;const i=C.delayedScripts[e];if(i){C.delayedScripts=Object.fromEntries(Object.entries(C.delayedScripts).filter((([t])=>t!==e)));const r=q[e];null==(t=null==window?void 0:window[r])?void 0:t.init(...i)}}};class ai extends class{setDomain(e){if(!e||"auto"===e)this.cookieDomain=(()=>{const e=new Date,t=location.hostname.split(".").reverse(),i=[],r=`gaDomain-${c(6)}`,n=c(6);let s="";for(e.setTime(e.getTime()+60*1e3),i.push(t.shift());t.length>0;){if(s=i.reverse().join("."),document.cookie=`${r}=${n}; expires=${e.toUTCString()}; domain=.${s}; path=/`,u(r)===n)return s;i.push(t.shift())}return location.hostname})();else this.cookieDomain=e}setListToken(e){this.listToken=e}}{constructor(e,t,i,r){super(),this.cookieDomain="",this.listToken="",this.email="",this.uuid=document.cookie.replace(/(?:(?:^|.*;\s*)gaVisitorUuid\s*\=\s*([^;]*).*$)|^.*$/,"$1")||"",this.valuable=Number(document.cookie.replace(/(?:(?:^|.*;\s*)gaIsValuable\s*\=\s*([^;]*).*$)|^.*$/,"$1")||0),this.gr_x=l("gr_x")||"",this.gr_s=l("gr_s")||"",this.gr_m=l("gr_m")||"",this.tracking=new f,this.wasPageVisitEventSaved=false,this.onEventPush=(e,t,i)=>{si.push(e,t,i)},this.onEventFlush=()=>{si.flush()},this.onImportScript=async(e,...t)=>{if(Object.values(G).includes(e)){const{webConnectScriptCdnUrl:i,webConnectCurrentScriptsVersion:r}=C,n=new URL(`${e}.${r}.umd.js`,i);import(n.href).then((()=>{window[q[e]].init(...t)}))}else h.error(`Invalid script name ${e}`)},this.onDomainSet=e=>{this.setDomain(e)},this.onListTokenSet=e=>{this.setListToken(e)},this.onSetUserId=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.setUserId(e,t)},this.onSetEvent=(e,t)=>{this.assureDomainIsSet(),this.assureUuidIsSet(),this.tracking.setUserId(this.serialize()),this.setEvent(e,t)},this.onSetCookie=(e,t)=>{d(e,t,this.cookieDomain)},this.onPush=()=>{this.push()},this.onSetCustomServiceWorkerPath=e=>{C.setCustomSwPath(e)},this.createDefaultEventsAndSave=()=>{if("hidden"===document.visibilityState){if(!this.wasPageVisitEventSaved)et().saveUserActivity(),this.wasPageVisitEventSaved=true;C.eventBus.publish(g.FlushEvents)}},this.xsid=i||"",this.tracking.setCustomVariable(1,"grid",t),this.tracking.setCustomVariable(2,"aid",r),this.tracking.setTrackerUrl(`${e}index.php?ver=3`),this.tracking.markAsEnabled(C.isTrackingEnabled()),this.tracking.setUserId(this.serialize())}async initialize(){if(!this.xsid&&!this.valuable&&C.isTrackingScriptServedFromCustomDomain())this.xsid=await J.retrieveXsid();this.attachListeners()}attachListeners(){const{eventBus:e}=C;e.subscribe(g.SetDomain,this.onDomainSet),e.subscribe(g.SetListToken,this.onListTokenSet),e.subscribe(g.SetUserId,this.onSetUserId),e.subscribe(g.SetEvent,this.onSetEvent),e.subscribe(g.SetCookie,this.onSetCookie),e.subscribe(g.Push,this.onPush),e.subscribe(g.SetCustomServiceWorkerPath,this.onSetCustomServiceWorkerPath),e.subscribe(g.ImportScript,this.onImportScript),e.subscribe(g.SetVisitUrlPath,this.onSetVisitUrlPath),e.subscribe(g.SetLastActivityDate,this.onSetLastActivityDate),e.subscribe(g.SetIsNewVisitor,this.onSetIsNewVisitor),e.subscribe(g.SetHasUserVisitPage,this.onSetHasUserVisitPage),e.subscribe(g.SetUserDevice,this.onSetDevice),e.subscribe(g.SetUserLocation,this.onSetUserLocation),e.subscribe(g.SetRawEvent,this.onSetRawEvent),e.subscribe(g.SaveEvent,this.onEventPush),e.subscribe(g.FlushEvents,this.onEventFlush),e.subscribe(g.DelayScript,this.onScriptDelay),e.subscribe(g.InitScript,this.onScriptInit)}assureDomainIsSet(){if(!this.cookieDomain)this.onDomainSet("auto")}assureUuidIsSet(){if(!this.uuid){const e=this.generateUuid();window.sessionStorage.setItem(m.UuidHasBeenSet,"true"),this.uuid=e}}setValuability(){if(this.gr_x&&this.gr_s)this.setIsValuable();if(this.email||this.xsid)this.setIsValuable()}assureEventsAreCreatedAndSaved(){document.addEventListener("visibilitychange",this.createDefaultEventsAndSave)}generateUuid(){let e=u("gaVisitorUuid");if(!e)e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),d("gaVisitorUuid",e,this.cookieDomain);return e}setUserId(e,t){if(e&&C.isTrackingEnabled())C.visitorEmail=e,this.email=e,this.listToken=t||this.listToken,this.setIsValuable(),this.push()}setEvent(e,t){if(void 0===t)this.tracking.trackEvent("custom","fire",e);else this.tracking.trackEvent("custom","fire",e,JSON.stringify(t))}push(){this.tracking.setUserId(this.serialize()),this.tracking.trackPageView()}setIsValuable(){if(C.isTrackingEnabled())this.valuable=1,d("gaIsValuable","1",this.cookieDomain)}serialize(){return JSON.stringify({uuid:this.uuid,email:this.email,xsid:this.xsid,list_token:this.listToken,gr_x:this.gr_x,gr_s:this.gr_s,gr_m:this.gr_m,valuable:this.valuable,domain:this.cookieDomain})}onSetVisitUrlPath(e){const t=_(gt,ht);if(t instanceof pt)t.setVisitPathUrl(e)}onSetLastActivityDate(e){const t=et();if(t instanceof Qe)t.setLastActivityDate(e)}onSetIsNewVisitor(e){const t=et();if(t instanceof Qe)t.setIsNewVisitor(e)}onSetHasUserVisitPage(e){const t=ut();if(t instanceof at)t.setHasUserVisitedPage(e)}onSetDevice(e){const t=_(yt,Dt);if(t instanceof bt)t.setDeviceType(e)}onSetUserLocation(e){const t=_(_t,Vt);if(t instanceof Tt)t.setVisitorCountryCode(e)}onSetRawEvent(e){const t=ri();if(t instanceof ti)t.saveEvent(e)}onScriptDelay(e){oi.delay(e)}onScriptInit(e){oi.initScript(e)}}e.init=e=>{const t=JSON.parse(e),{grid:i,clientLatestGrid:r,aid:n,xsid:s,isServedFromCustomDomain:o,scriptVersion:a,scriptDomain:c,useBackendSubscriberIdentification:u,useBackendStorage:d,trackingUrl:l,tracking:v,isDebugMode:p}=t,h=window["__GetResponseAnalyticsObject"]||"GrTracking";C.initialize({xsid:s,aid:n,grid:i,clientLatestGrid:r,domain:l,useNOStorage:"true"===d,useBetterSubscriberIdentification:"true"===u,isServedFromCustomDomain:"true"===o,scriptsDomain:c,scriptsVersion:a,tracking:"true"===v,isDebugMode:"true"===p});const w=new ai(l,i,s,n);function f(e,t){window[h](e,t)}w.initialize().then((()=>{var e;if(Array.isArray(null==(e=window[h])?void 0:e.q))window[h].q.forEach(((e,t)=>{if("push"!==e[0])C.eventBus.publish(e[0],e[1],e[2]),delete window[h].q[t]}));window[h]=(e,t,i)=>{C.eventBus.publish(e,t,i)},w.assureDomainIsSet(),w.assureUuidIsSet(),w.setValuability(),C.eventBus.publish(g.Push),w.assureEventsAreCreatedAndSaved()})),window.gaSetUserId=e=>{f(g.SetUserId,e)},window.gaPush=()=>{f(g.Push)}},Object.defineProperties(e,{__esModule:{value:true},[Symbol.toStringTag]:{value:"Module"}})}((e="undefined"!=typeof globalThis?globalThis:e||self).GRV2={})}(this);
